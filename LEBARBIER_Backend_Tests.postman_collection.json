{
  "info": {
    "name": "LE BARBIER - Tests Backend Complets",
    "description": "Collection Postman compl√®te pour tester tous les endpoints backend de l'application LE BARBIER",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "version": "3.0.0"
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:3001",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "üîê Authentification",
      "item": [
        {
          "name": "1. Register (Inscription)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"newuser@example.com\",\n  \"password\": \"Password123!\",\n  \"firstName\": \"John\",\n  \"lastName\": \"Doe\",\n  \"phone\": \"+237600000000\",\n  \"acceptTerms\": true\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/auth/register",
              "host": ["{{baseUrl}}"],
              "path": ["api", "auth", "register"]
            },
            "description": "Cr√©er un nouveau compte utilisateur (CLIENT par d√©faut)"
          },
          "response": []
        },
        {
          "name": "2. Login - Client",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"test@example.com\",\n  \"password\": \"Password123!\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/auth/callback/credentials",
              "host": ["{{baseUrl}}"],
              "path": ["api", "auth", "callback", "credentials"]
            },
            "description": "Se connecter en tant que CLIENT (m√™me endpoint pour tous les r√¥les)"
          },
          "response": []
        },
        {
          "name": "3. Login - Employee",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"employee@lebarbier.com\",\n  \"password\": \"Employee123!\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/auth/callback/credentials",
              "host": ["{{baseUrl}}"],
              "path": ["api", "auth", "callback", "credentials"]
            },
            "description": "Se connecter en tant que EMPLOYEE (m√™me endpoint, diff√©renciation automatique par r√¥le)"
          },
          "response": []
        },
        {
          "name": "4. Login - Admin",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"admin@lebarbier.com\",\n  \"password\": \"Admin123!\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/auth/callback/credentials",
              "host": ["{{baseUrl}}"],
              "path": ["api", "auth", "callback", "credentials"]
            },
            "description": "Se connecter en tant que ADMIN (m√™me endpoint, diff√©renciation automatique par r√¥le)"
          },
          "response": []
        },
        {
          "name": "5. Get Session",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/auth/session",
              "host": ["{{baseUrl}}"],
              "path": ["api", "auth", "session"]
            },
            "description": "R√©cup√©rer la session actuelle (n√©cessite d'√™tre connect√©)"
          },
          "response": []
        },
        {
          "name": "6. Logout",
          "request": {
            "method": "POST",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/auth/logout",
              "host": ["{{baseUrl}}"],
              "path": ["api", "auth", "logout"]
            },
            "description": "Se d√©connecter (tous r√¥les)"
          },
          "response": []
        }
      ],
      "description": "Endpoints d'authentification - Identiques pour tous les r√¥les (CLIENT, EMPLOYEE, ADMIN)"
    },
    {
      "name": "üë§ Profil Utilisateur (Tous r√¥les)",
      "item": [
        {
          "name": "1. Get My Profile",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/user/profile",
              "host": ["{{baseUrl}}"],
              "path": ["api", "user", "profile"]
            },
            "description": "R√©cup√©rer son propre profil (CLIENT, EMPLOYEE ou ADMIN)"
          },
          "response": []
        },
        {
          "name": "2. Update My Profile",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"firstName\": \"John Updated\",\n  \"lastName\": \"Doe Updated\",\n  \"phone\": \"+237611111111\",\n  \"language\": \"FR\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/user/profile",
              "host": ["{{baseUrl}}"],
              "path": ["api", "user", "profile"]
            },
            "description": "Modifier son propre profil"
          },
          "response": []
        }
      ],
      "description": "Gestion du profil utilisateur - Accessible √† tous les utilisateurs connect√©s"
    },
    {
      "name": "üëî Employ√© (EMPLOYEE + ADMIN)",
      "item": [
        {
          "name": "1. Get My Appointments",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/employee/appointments",
              "host": ["{{baseUrl}}"],
              "path": ["api", "employee", "appointments"]
            },
            "description": "R√©cup√©rer tous les rendez-vous de l'employ√© connect√©"
          },
          "response": []
        },
        {
          "name": "2. Get Appointments by Status",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/employee/appointments?status=PENDING",
              "host": ["{{baseUrl}}"],
              "path": ["api", "employee", "appointments"],
              "query": [
                {
                  "key": "status",
                  "value": "PENDING",
                  "description": "PENDING, CONFIRMED, IN_PROGRESS, COMPLETED, CANCELLED"
                }
              ]
            },
            "description": "Filtrer les rendez-vous par statut"
          },
          "response": []
        },
        {
          "name": "3. Get Appointments by Date",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/employee/appointments?date=2024-12-19",
              "host": ["{{baseUrl}}"],
              "path": ["api", "employee", "appointments"],
              "query": [
                {
                  "key": "date",
                  "value": "2024-12-19",
                  "description": "Format: YYYY-MM-DD"
                }
              ]
            },
            "description": "Filtrer les rendez-vous par date"
          },
          "response": []
        },
        {
          "name": "4. Update Appointment Status",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"appointmentId\": \"cm...\",\n  \"status\": \"CONFIRMED\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/employee/appointments",
              "host": ["{{baseUrl}}"],
              "path": ["api", "employee", "appointments"]
            },
            "description": "Modifier le statut d'un rendez-vous (PENDING, CONFIRMED, IN_PROGRESS, COMPLETED, CANCELLED)"
          },
          "response": []
        }
      ],
      "description": "Endpoints pour les employ√©s - Accessible aux EMPLOYEE et ADMIN uniquement"
    },
    {
      "name": "üëë Admin (ADMIN uniquement)",
      "item": [
        {
          "name": "1. Get All Users",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/admin/users",
              "host": ["{{baseUrl}}"],
              "path": ["api", "admin", "users"]
            },
            "description": "R√©cup√©rer tous les utilisateurs (ADMIN uniquement)"
          },
          "response": []
        },
        {
          "name": "2. Get Users by Role",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/admin/users?role=CLIENT",
              "host": ["{{baseUrl}}"],
              "path": ["api", "admin", "users"],
              "query": [
                {
                  "key": "role",
                  "value": "CLIENT",
                  "description": "CLIENT, EMPLOYEE, ADMIN"
                }
              ]
            },
            "description": "Filtrer les utilisateurs par r√¥le"
          },
          "response": []
        },
        {
          "name": "3. Search Users",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/admin/users?search=john",
              "host": ["{{baseUrl}}"],
              "path": ["api", "admin", "users"],
              "query": [
                {
                  "key": "search",
                  "value": "john",
                  "description": "Rechercher par nom ou email"
                }
              ]
            },
            "description": "Rechercher des utilisateurs"
          },
          "response": []
        },
        {
          "name": "4. Get Active Users",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/admin/users?isActive=true",
              "host": ["{{baseUrl}}"],
              "path": ["api", "admin", "users"],
              "query": [
                {
                  "key": "isActive",
                  "value": "true",
                  "description": "true ou false"
                }
              ]
            },
            "description": "Filtrer par statut actif/inactif"
          },
          "response": []
        },
        {
          "name": "5. Create User",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"newemployee@lebarbier.com\",\n  \"password\": \"SecurePass123!\",\n  \"firstName\": \"Marie\",\n  \"lastName\": \"Dupont\",\n  \"phone\": \"+237622222222\",\n  \"role\": \"EMPLOYEE\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/admin/users",
              "host": ["{{baseUrl}}"],
              "path": ["api", "admin", "users"]
            },
            "description": "Cr√©er un nouvel utilisateur avec n'importe quel r√¥le (ADMIN uniquement)"
          },
          "response": []
        }
      ],
      "description": "Endpoints d'administration - Accessible aux ADMIN uniquement"
    },
    {
      "name": "ÔøΩ Rendez-vous - CRUD Complet",
      "item": [
        {
          "name": "1. Get My Appointments",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/appointments",
              "host": ["{{baseUrl}}"],
              "path": ["api", "appointments"]
            },
            "description": "R√©cup√©rer tous mes rendez-vous avec statistiques par statut"
          },
          "response": []
        },
        {
          "name": "2. Get Appointments - Filter by Status",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/appointments?status=PENDING",
              "host": ["{{baseUrl}}"],
              "path": ["api", "appointments"],
              "query": [
                {
                  "key": "status",
                  "value": "PENDING",
                  "description": "PENDING | CONFIRMED | IN_PROGRESS | COMPLETED | CANCELLED"
                }
              ]
            },
            "description": "Filtrer les rendez-vous par statut"
          },
          "response": []
        },
        {
          "name": "3. Get Appointments - Date Range",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/appointments?startDate=2024-12-01&endDate=2024-12-31",
              "host": ["{{baseUrl}}"],
              "path": ["api", "appointments"],
              "query": [
                {
                  "key": "startDate",
                  "value": "2024-12-01",
                  "description": "Format: YYYY-MM-DD"
                },
                {
                  "key": "endDate",
                  "value": "2024-12-31",
                  "description": "Format: YYYY-MM-DD"
                }
              ]
            },
            "description": "Filtrer par plage de dates"
          },
          "response": []
        },
        {
          "name": "4. Create Appointment",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"employeeId\": \"cm...\",\n  \"serviceId\": \"cm...\",\n  \"date\": \"2024-12-20T10:00:00Z\",\n  \"endTime\": \"2024-12-20T11:00:00Z\",\n  \"location\": \"SALON\",\n  \"notes\": \"Coupe classique + taille barbe\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/appointments",
              "host": ["{{baseUrl}}"],
              "path": ["api", "appointments"]
            },
            "description": "Cr√©er un nouveau rendez-vous. Location: SALON ou HOME (HOME ajoute 5000 FCFA de frais)"
          },
          "response": []
        },
        {
          "name": "5. Get Appointment by ID",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/appointments/cm...",
              "host": ["{{baseUrl}}"],
              "path": ["api", "appointments", "cm..."]
            },
            "description": "R√©cup√©rer un rendez-vous sp√©cifique (propri√©taire ou admin seulement)"
          },
          "response": []
        },
        {
          "name": "6. Update Appointment",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"status\": \"CONFIRMED\",\n  \"notes\": \"Notes mises √† jour\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/appointments/cm...",
              "host": ["{{baseUrl}}"],
              "path": ["api", "appointments", "cm..."]
            },
            "description": "Modifier un rendez-vous (statut, notes, raison annulation)"
          },
          "response": []
        },
        {
          "name": "7. Cancel Appointment",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"status\": \"CANCELLED\",\n  \"cancellationReason\": \"Client a chang√© d'avis\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/appointments/cm...",
              "host": ["{{baseUrl}}"],
              "path": ["api", "appointments", "cm..."]
            },
            "description": "Annuler un rendez-vous avec raison"
          },
          "response": []
        },
        {
          "name": "8. Delete Appointment",
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/appointments/cm...",
              "host": ["{{baseUrl}}"],
              "path": ["api", "appointments", "cm..."]
            },
            "description": "Supprimer d√©finitivement un rendez-vous (propri√©taire ou admin)"
          },
          "response": []
        },
        {
          "name": "9. Check Availability",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/appointments/availability?employeeId=cm...&date=2024-12-20",
              "host": ["{{baseUrl}}"],
              "path": ["api", "appointments", "availability"],
              "query": [
                {
                  "key": "employeeId",
                  "value": "cm...",
                  "description": "ID de l'employ√©"
                },
                {
                  "key": "date",
                  "value": "2024-12-20",
                  "description": "Date (YYYY-MM-DD)"
                }
              ]
            },
            "description": "V√©rifier les cr√©neaux disponibles d'un employ√© (8h-18h, cr√©neaux horaires)"
          },
          "response": []
        }
      ],
      "description": "CRUD complet des rendez-vous - GET (liste + filtres), POST (cr√©er), GET by ID, PUT (modifier), DELETE (supprimer), Availability (disponibilit√©s)"
    },
    {
      "name": "ÔøΩ Services - CRUD Complet",
      "item": [
        {
          "name": "1. Get All Services",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/services",
              "host": ["{{baseUrl}}"],
              "path": ["api", "services"]
            },
            "description": "R√©cup√©rer tous les services actifs avec statistiques par cat√©gorie (PUBLIC)"
          },
          "response": []
        },
        {
          "name": "2. Get Service by ID",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/services/cm...",
              "host": ["{{baseUrl}}"],
              "path": ["api", "services", "cm..."]
            },
            "description": "R√©cup√©rer un service sp√©cifique par son ID (PUBLIC)"
          },
          "response": []
        },
        {
          "name": "3. Create Service (ADMIN)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Coupe Premium\",\n  \"description\": \"Coupe de cheveux premium avec shampoing et massage\",\n  \"price\": 15000,\n  \"duration\": 60,\n  \"category\": \"COUPE\",\n  \"imageUrl\": \"https://example.com/coupe-premium.jpg\",\n  \"isActive\": true\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/services",
              "host": ["{{baseUrl}}"],
              "path": ["api", "services"]
            },
            "description": "Cr√©er un nouveau service (ADMIN uniquement). Categories: COUPE, BARBE, COLORATION, SOIN, COMBO"
          },
          "response": []
        },
        {
          "name": "4. Update Service (ADMIN)",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Coupe Premium Updated\",\n  \"price\": 18000,\n  \"duration\": 75,\n  \"description\": \"Description mise √† jour\",\n  \"isActive\": true\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/services/cm...",
              "host": ["{{baseUrl}}"],
              "path": ["api", "services", "cm..."]
            },
            "description": "Modifier un service existant (ADMIN uniquement)"
          },
          "response": []
        },
        {
          "name": "5. Deactivate Service (ADMIN)",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"isActive\": false\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/services/cm...",
              "host": ["{{baseUrl}}"],
              "path": ["api", "services", "cm..."]
            },
            "description": "D√©sactiver un service (soft delete - ADMIN uniquement)"
          },
          "response": []
        },
        {
          "name": "6. Delete Service (ADMIN)",
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/services/cm...",
              "host": ["{{baseUrl}}"],
              "path": ["api", "services", "cm..."]
            },
            "description": "Supprimer d√©finitivement un service (ADMIN uniquement - DANGER)"
          },
          "response": []
        }
      ],
      "description": "CRUD complet des services - GET (public), POST/PUT/DELETE (ADMIN uniquement)"
    },
    {
      "name": "üë• Employ√©s (Public)",
      "item": [
        {
          "name": "1. Get All Employees",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/employees",
              "host": ["{{baseUrl}}"],
              "path": ["api", "employees"]
            },
            "description": "R√©cup√©rer la liste des employ√©s (public)"
          },
          "response": []
        },
        {
          "name": "2. Get Employee Availability",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/employees/[id]/availability?date=2024-12-20",
              "host": ["{{baseUrl}}"],
              "path": ["api", "employees", "[id]", "availability"],
              "query": [
                {
                  "key": "date",
                  "value": "2024-12-20"
                }
              ]
            },
            "description": "V√©rifier la disponibilit√© d'un employ√©"
          },
          "response": []
        }
      ],
      "description": "Informations sur les employ√©s - Accessible √† tous"
    },
    {
      "name": "üß™ Tests de Protection",
      "item": [
        {
          "name": "Test 1: Client acc√®de √† route employ√© (DOIT √âCHOUER)",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/employee/appointments",
              "host": ["{{baseUrl}}"],
              "path": ["api", "employee", "appointments"]
            },
            "description": "Un CLIENT ne doit PAS pouvoir acc√©der aux routes employ√©s ‚Üí Attendu: 403 Forbidden"
          },
          "response": []
        },
        {
          "name": "Test 2: Client acc√®de √† route admin (DOIT √âCHOUER)",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/admin/users",
              "host": ["{{baseUrl}}"],
              "path": ["api", "admin", "users"]
            },
            "description": "Un CLIENT ne doit PAS pouvoir acc√©der aux routes admin ‚Üí Attendu: 403 Forbidden"
          },
          "response": []
        },
        {
          "name": "Test 3: Employee acc√®de √† route admin (DOIT √âCHOUER)",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/admin/users",
              "host": ["{{baseUrl}}"],
              "path": ["api", "admin", "users"]
            },
            "description": "Un EMPLOYEE ne doit PAS pouvoir acc√©der aux routes admin ‚Üí Attendu: 403 Forbidden"
          },
          "response": []
        },
        {
          "name": "Test 4: Sans connexion (DOIT √âCHOUER)",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/user/profile",
              "host": ["{{baseUrl}}"],
              "path": ["api", "user", "profile"]
            },
            "description": "Sans √™tre connect√©, ne doit PAS acc√©der aux routes prot√©g√©es ‚Üí Attendu: 401 Unauthorized"
          },
          "response": []
        }
      ],
      "description": "Tests pour v√©rifier que la protection des routes fonctionne correctement"
    }
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Script ex√©cut√© avant chaque requ√™te",
          "console.log('üöÄ Requ√™te vers:', pm.request.url.toString());"
        ]
      }
    },
    {
      "listen": "test",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Tests automatiques apr√®s chaque requ√™te",
          "pm.test('Response time is less than 5000ms', function () {",
          "    pm.expect(pm.response.responseTime).to.be.below(5000);",
          "});",
          "",
          "pm.test('Response has valid JSON', function () {",
          "    pm.response.to.have.jsonBody();",
          "});"
        ]
      }
    }
  ]
}
